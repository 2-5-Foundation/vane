"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "setupWithServer", {
    enumerable: true,
    get: function() {
        return setupWithServer;
    }
});
const _server = require("./server.js");
const _index = require("./rpc/index.js");
const _chopstickscore = require("@acala-network/chopsticks-core");
const _context = require("./context.js");
const setupWithServer = async (argv)=>{
    const context = await (0, _context.setupContext)(argv);
    const port = argv.port ?? 8000;
    if (argv.genesis) {
        // mine 1st block when starting from genesis to set some mock validation data
        await context.chain.newBlock();
    }
    const { close, port: listenPort } = await (0, _server.createServer)((0, _index.handler)(context), port);
    _chopstickscore.logger.info(`${await context.chain.api.getSystemChain()} RPC listening on port ${listenPort}`);
    return {
        ...context,
        listenPort,
        async close () {
            await context.chain.close();
            await close();
        }
    };
};
